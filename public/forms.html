<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Piget Forms Review</title>
  <link rel="stylesheet" href="css/form.css">
</head>
<body>
  <div class="form-review-container">
    <h1>Pending User Requests</h1>
    <div id="request-list">Loading...</div>
  </div>

  <script>
    async function loadRequests() {
      try {
        const res = await fetch('/requests');
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const requests = await res.json();
        if (!Array.isArray(requests)) throw new Error('Invalid response format');

        const container = document.getElementById('request-list');
        container.innerHTML = '';

        if (requests.length === 0) {
          container.innerHTML = '<p>No pending requests.</p>';
          return;
        }

        requests.forEach(req => {
          const item = document.createElement('div');
          item.className = 'request-item';
          item.innerHTML = `
            <p><strong>Username:</strong> ${req.username}</p>
            <p><strong>Age:</strong> ${req.age}</p>
            <p><strong>Discord:</strong> ${req.discord}</p>
            <p><strong>Reason:</strong> ${req.reason}</p>
            <button onclick="approve(${req.id})">Approve</button>
            <button onclick="deny(${req.id})">Deny</button>
            <hr>
          `;
          container.appendChild(item);
        });
      } catch (err) {
        console.error("Error loading requests:", err);
        document.getElementById('request-list').innerHTML = `<p style="color: red;">Failed to load requests.</p>`;
      }
    }

    async function approve(id) {
      await fetch('/approve', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id })
      });
      loadRequests();
    }

    async function deny(id) {
      await fetch('/deny', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id })
      });
      loadRequests();
    }

    loadRequests();
  </script>
</body>
</html>
