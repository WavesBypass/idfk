<!DOCTYPE html>
<html>
<head>
  <title>Form Requests</title>
  <link rel="stylesheet" href="css/form.css">
</head>
<body>
  <h1>Pending Requests</h1>
  <div id="requestsContainer"></div>

  <script>
    async function loadRequests() {
      try {
        const response = await fetch('/requests');
        if (!response.ok) throw new Error('HTTP ' + response.status);
        const requests = await response.json();
        const container = document.getElementById('requestsContainer');
        container.innerHTML = '';

        if (!Array.isArray(requests)) {
          throw new Error('Invalid response format');
        }

        requests.forEach(req => {
          const div = document.createElement('div');
          div.innerHTML = `
            <p><strong>Username:</strong> ${req.username}</p>
            <p><strong>Reason:</strong> ${req.reason}</p>
            <p><strong>Status:</strong> ${req.status}</p>
            ${req.status === 'pending' ? `
              <button onclick="handleRequest(${req.id}, 'approve')">Approve</button>
              <button onclick="handleRequest(${req.id}, 'deny')">Deny</button>
            ` : ''}
            <hr>
          `;
          container.appendChild(div);
        });
      } catch (err) {
        console.error('Error loading requests:', err);
      }
    }

    async function handleRequest(id, action) {
      try {
        const response = await fetch('/approve-request', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id, action })
        });
        const result = await response.json();
        if (result.success) {
          loadRequests();
        } else {
          alert('Failed: ' + (result.error || 'Unknown error'));
        }
      } catch (err) {
        console.error('Handle request error:', err);
      }
    }

    loadRequests();
  </script>
</body>
</html>
